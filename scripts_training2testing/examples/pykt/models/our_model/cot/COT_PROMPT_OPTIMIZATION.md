# CoT Prompt 优化分析报告

## 一、当前问题分析

### 1. 语言适配问题

**问题**：当前提示词完全使用中文，但数据集中包含：
- **XES3G5M**：中文数据集 ✓
- **DBE-KT22**：英文数据集 ✗
- **Eedi**：英文数据集 ✗

**影响**：
- 对英文数据集，中文提示词可能导致MLLM理解偏差
- 生成的CoT可能不符合英文数据集的表达习惯

### 2. 数据集特定信息未充分利用

#### XES3G5M 的独特信息（未使用）：
- ✅ 树状知识点路径（显式先决关系）
- ✅ 题型标签（单选/填空）
- ✅ 题干文本、标准答案、逐题解析

#### DBE-KT22 的独特信息（未使用）：
- ✅ KC层次图
- ✅ 专家难度评分
- ✅ 学生自评难度/信心
- ✅ 答题时长
- ✅ 改答次数
- ✅ 题文-选项-提示文本

#### Eedi 的独特信息（未使用）：
- ✅ 干扰项对应的明确误区（3个干扰项）
- ✅ 学生属性（性别、出生月、贫困生标识）
- ✅ 题目专家质量排序
- ✅ 学科树结构

### 3. 验证函数语言问题

`validate_cot` 函数只检查中文关键词：
```python
required_keywords = ['知识点', '掌握', '题目']  # 仅中文
```
对英文数据集不适用。

## 二、优化方案

### 方案1：数据集自适应的提示词生成

根据数据集类型动态生成中英文提示词，并利用数据集特定信息。

### 方案2：多语言提示词模板

为每个数据集设计专门的提示词模板，充分利用各自特性。

### 方案3：可配置的提示词参数

通过配置参数传递数据集特定信息，在提示词中动态插入。

## 三、具体优化建议

### 1. 添加数据集语言检测

```python
# 数据集语言映射
DATASET_LANGUAGE = {
    'XES3G5M': 'zh',
    'DBE_KT22': 'en',
    'Eedi': 'en',
    'NIPS_task34': 'en'  # 假设英文
}
```

### 2. 多语言提示词模板

**中文模板（XES3G5M）**：
- 保持现有结构
- 添加知识点路径信息
- 添加题型信息

**英文模板（DBE-KT22, Eedi）**：
- 完整的英文提示词
- 利用难度、信心、时长等信息
- 利用误区信息（Eedi）

### 3. 增强的提示词内容

#### 针对XES3G5M：
- 利用知识点先决关系：提示模型考虑知识点依赖
- 利用题型标签：单选和填空题的推理策略不同

#### 针对DBE-KT22：
- 专家难度：辅助判断题目复杂度
- 学生自评：提供额外信息
- 答题时长和改答次数：反映学生思考过程

#### 针对Eedi：
- 干扰项误区：帮助理解常见错误
- 学生属性：考虑个体差异
- 专家质量排序：题目质量信息

### 4. 多语言验证函数

```python
def validate_cot(cot_text: str, language: str = 'zh', ...):
    if language == 'zh':
        required_keywords = ['知识点', '掌握', '题目']
    else:  # en
        required_keywords = ['knowledge', 'mastery', 'question', 'concept']
    ...
```

## 四、推荐实现优先级

### 高优先级（立即优化）：
1. ✅ **多语言提示词支持**：为英文数据集添加英文提示词 **[已实现]**
2. ✅ **数据集语言检测**：自动识别数据集语言 **[已实现]**
3. ✅ **多语言验证函数**：支持中英文关键词检查 **[已实现]**

### 已实现的功能：

#### 1. 数据集语言映射
- 在 `cot_prompts.py` 中添加了 `DATASET_LANGUAGE` 字典
- 自动识别数据集语言：XES3G5M(zh), DBE_KT22(en), Eedi(en), NIPS_task34(en)

#### 2. 多语言提示词生成
- `build_cot_prompt()` 函数现在支持 `dataset_name` 和 `language` 参数
- 根据语言自动选择中文模板 (`_build_cot_prompt_zh`) 或英文模板 (`_build_cot_prompt_en`)
- 两个模板结构一致，但语言适配

#### 3. 多语言验证
- `validate_cot()` 函数现在支持 `language` 参数
- 中文检查关键词：['知识点', '掌握', '题目', '学生', '知识', '概念', '答对', '答错']
- 英文检查关键词：['knowledge', 'concept', 'mastery', 'question', 'student', 'learn', 'know', 'point', 'understand', 'correct', 'incorrect']

#### 4. 代码更新
- `CoTGenerator.__init__()` 添加 `dataset_name` 参数
- `CoTGenerator.generate_cot()` 传递 `dataset_name` 给 `build_cot_prompt()`
- `validate_cot()` 调用时自动传递语言参数
- 默认CoT文本生成也支持多语言
- `ThinkKT` 模型初始化时传递 `dataset_name` 给 `CoTGenerator`

### 中优先级（后续优化）：
4. ⚠️ **XES3G5M知识点路径利用**：在提示词中加入知识点依赖关系
5. ⚠️ **DBE-KT22难度信息利用**：专家难度、学生自评等信息
6. ⚠️ **Eedi误区信息利用**：干扰项对应的常见错误

### 低优先级（可选优化）：
7. 📋 **题型标签利用**：针对不同题型优化提示词
8. 📋 **学生属性利用**：性别、年龄等信息
9. 📋 **答题行为利用**：时长、改答次数等

